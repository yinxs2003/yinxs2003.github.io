---
title: 网站安全漏洞预防
date: 2016-06-13
tags: 安全
---
# sql注入攻击
MyBatis 避免了几乎所有的sql注入。mybatis在配置SQL语句的时候，有两种描述参数的方式。#{}和${}，尽量不要使用${}。使用“#”时，mybatis会使用预编译来处理参数，这样可以避免SQL注入。如果一定要使用$，则需要自己过滤用户输入。详细参见http://www.evil0x.com/posts/19367.html

``` sql
<select id="selectPerson" parameterType="int" resultType="hashmap"> 
    SELECT * FROM PERSON WHERE ID = #{id} 
</select>
```

# xss攻击
XSS 全称(Cross Site Scripting) 跨站脚本攻击，可以使用如下方式防御xss攻击。
## 启用HttpOnly
如果你正在使用的是兼容 Java EE 6.0 的容器，如 Tomcat 7，那么 Cookie 类已经有了setHttpOnly 的方法来使用 HttpOnly 的 Cookie 属性了
``` java
cookie.setHttpOnly(true);
```
也可以在 web.xml 配置如下：
``` bash
<session-config>
 <cookie-config>
  <http-only>true</http-only>
 </cookie-config>
<session-config>
```

xss攻击防御参见 http://www.oschina.net/question/12_72706?fromerr=24QoGVJN
## 对用户输入进行限制
一般不这么做
## 对用户输入进行转译
每个语言都有自己的encode函数，用html encode函数过滤能杜绝大多数xss攻击
比如，你可以使用StringEscapeUtils来转译用户的输入，maven依赖如下
``` xml
<dependency>
<groupId>commons-lang</groupId>
<artifactId>commons-lang</artifactId>
<version>2.6</version>
</dependency>
```
java转译代码如下
``` java 
String input="中文转字符的HTML实体表示形式";
string convertedStr = StringEscapeUtils.escapeHtml(s);//对输入进行转译转译
```

# 不安全session认证和会话管理
## 在web.xml中设置超时时间
session超时时间30分钟
``` xml
 <session-config>
  <session-timeout>30</session-timeout>
 </session-config>
```

## 在代码设置超时时间
session超时时间为30分钟
``` xml
 HttpSession session = request.getSession();
 session.setMaxInactiveInterval(1800);//单位为秒
```
# 不安全对象直接引用
javaweb没有该问题

# 防止CSRF攻击
CSRF（Cross-site request forgery），中文名称“跨站请求伪造”
防御措施
* 提交修改信息使用post而不是get方式
* 关键表单提交使用验证码
* 客户端页面增加伪随机数，请参考
http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html
http://www.cnblogs.com/dolphinX/p/3403520.html

# 不安全加密存储
使用强大的标准哈希算法和合理的 salt 来保护密码。

# 未限制的url访问
使用AngularJS对路由进行安全性处理来禁止未授权用户访问一些需要权限的页面，详细可以参考http://www.lai18.com/content/433226.html

# 使用http协议加密敏感信息

提供恰当的传输层保护会影响网站的设计。最简单的方法是要求SSL用于整个网站。由于性能原因，一些网站仅在私有页面中使用SSL。而其他一些网站仅在“关键”的网页中使用SSL，但这样就可能暴露会话ID和其他敏感数据。因此，至少要做到如下几点：
* 要求所有敏感网页都使用SSL。对这些网页的非SSL请求应被重定向到相应的SSL网页。
* 对所有敏感的Cookie都设置“安全”(“secure”) 标志。
* 配置你的SSL的供应端只支持强大的（比如符合FIPS 140-2标准）算法。
* 确保你的证书是有效的，没有过期，没有被废除，并匹配网站使用的所有域。
* 后端和其他连接也应该使用SSL或其他加密技术。


## 未验证的redirectUrl和转发的防御措施
重定向和转发的安全使用可以有多种方式完成：
* 避免使用重定向和转发。
* 如果使用了重定向和转发，则不要在计算目标时涉及到用户参数。这通常容易做到。
* 如果使用目标参数无法避免,应确保其所提供的值对于当前用户是有效的,并已经授权。
* 建议把这种目标的参数做成一个映射值，而不是真的URL或其中的一部分，然后由服务器端代码将映射值转换成目标URL。
* 应用程序可以使用ESAPI重写sendRedirect()方法来确保所有重定向的目的地是安全的。
